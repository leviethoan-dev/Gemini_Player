<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’Ž Gemini Player - Official Edition</title>
    <style>
        :root { --main-color: #00f2ff; --bg-dark: #0a0a0a; }
        body { background: var(--bg-dark); color: white; font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background: #ffffff; color: #333; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,242,255,0.3); width: 90%; max-width: 800px; text-align: center; }
        h1 { margin-bottom: 20px; color: #2c3e50; display: flex; align-items: center; justify-content: center; gap: 10px; }
        canvas { background: black; width: 100%; height: 200px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #eee; }
        .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; }
        .input-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; color: #008B8B; }
        textarea { padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; height: 120px; font-family: 'Courier New', monospace; resize: none; transition: 0.3s; }
        textarea:focus { border-color: var(--main-color); outline: none; }
        .settings { margin-top: 25px; display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; background: #f0fdfd; padding: 15px; border-radius: 12px; }
        input[type="number"] { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; width: 100px; text-align: center; }
        .btn-play { background: linear-gradient(135deg, #00b8d4, #00e5ff); color: white; border: none; padding: 15px 40px; font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer; transition: 0.3s; text-transform: uppercase; box-shadow: 0 5px 15px rgba(0,229,255,0.4); }
        .btn-play.playing { background: linear-gradient(135deg, #ff4e50, #f9d423); }
        .footer { margin-top: 15px; font-size: 11px; color: #888; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸ’Ž Gemini Player ðŸ’Ž</h1>
        <canvas id="visualizer"></canvas>

        <div class="controls-grid">
            <div class="input-group">
                <label>ðŸ”Š Bytebeat:</label>
                <textarea id="bytebeatCode" placeholder="VÃ­ dá»¥: t&t>>8"></textarea>
            </div>
            <div class="input-group">
                <label>ðŸŒŠ Floatbeat:</label>
                <textarea id="floatbeatCode" placeholder="VÃ­ dá»¥: sin(t/100)"></textarea>
            </div>
        </div>

        <div class="settings">
            <div>
                <label style="display:inline">Sample Rate:</label>
                <input type="number" id="sampleRate" value="8000">
            </div>
            <button id="playBtn" class="btn-play">Play & Save</button>
        </div>
        <div class="footer">Dá»± Ã¡n cá»§a Hiáº¿u (leviethoan-dev) | BÃ­ máº­t: eval() & Rickroll</div>
    </div>

<script>
    let audioCtx, scriptNode, isPlaying = false, t = 0;
    const canvas = document.getElementById('visualizer'), ctx = canvas.getContext('2d');
    const playBtn = document.getElementById('playBtn');

    // KhÃ´i phá»¥c dá»¯ liá»‡u
    window.onload = () => {
        document.getElementById('bytebeatCode').value = localStorage.getItem('gm_byte') || "t&t>>8";
        document.getElementById('floatbeatCode').value = localStorage.getItem('gm_float') || "";
        document.getElementById('sampleRate').value = localStorage.getItem('gm_sr') || "8000";
        resize();
    };

    function resize() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }

    function draw(data) {
        ctx.fillStyle = 'black'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        let hue = (Date.now() / 20) % 360; // DISCO MODE
        ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
        ctx.lineWidth = 3; ctx.beginPath();
        const sliceWidth = canvas.width / data.length;
        let x = 0;
        for (let i = 0; i < data.length; i++) {
            const v = data[i];
            const y = (v * 0.5 + 0.5) * canvas.height;
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            x += sliceWidth;
        }
        ctx.stroke();
    }

    playBtn.onclick = () => {
        if (isPlaying) {
            if (audioCtx) audioCtx.close();
            isPlaying = false;
            playBtn.innerText = "Play & Save";
            playBtn.classList.remove('playing');
            t = 0;
            return;
        }

        const sr = parseInt(document.getElementById('sampleRate').value) || 8000;
        const bCode = document.getElementById('bytebeatCode').value.trim();
        const fCode = document.getElementById('floatbeatCode').value.trim();

        localStorage.setItem('gm_byte', bCode);
        localStorage.setItem('gm_float', fCode);
        localStorage.setItem('gm_sr', sr);

        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: sr });
            scriptNode = audioCtx.createScriptProcessor(4096, 0, 1);

            // Giáº£i nÃ©n toÃ¡n há»c cho eval/Function Ä‘á»‰nh cao cá»§a Hiáº¿u
            const math = Math;
            const {sin, cos, tan, floor, abs, random, PI, min, max, pow, sqrt} = math;

            let fB = bCode ? new Function('t', 'sin', 'cos', 'tan', 'floor', 'abs', 'random', 'PI', 'min', 'max', 'pow', 'sqrt', `return ${bCode};`) : null;
            let fF = fCode ? new Function('t', 'sin', 'cos', 'tan', 'floor', 'abs', 'random', 'PI', 'min', 'max', 'pow', 'sqrt', `return ${fCode};`) : null;

            scriptNode.onaudioprocess = (e) => {
                const output = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < output.length; i++) {
                    let vB = fB ? (((fB(t,sin,cos,tan,floor,abs,random,PI,min,max,pow,sqrt)|0)&255)/127.5)-1 : 0;
                    let vF = fF ? fF(t,sin,cos,tan,floor,abs,random,PI,min,max,pow,sqrt) : 0;
                    output[i] = bCode && fCode ? (vB + vF)/2 : (bCode ? vB : vF);
                    t++;
                }
                draw(output);
            };

            scriptNode.connect(audioCtx.destination);
            isPlaying = true;
            playBtn.innerText = "Stop & Save";
            playBtn.classList.add('playing');

        } catch (err) {
            alert("Code sai lÃ  ngon luÃ´n! Ä‚n Rickroll nhÃ©.");
            window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ", "_blank");
            location.reload();
        }
    };
    window.onresize = resize;
</script>
</body>
</html>