<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ðŸ’Ž Gemini Player - leviethoan-dev</title>
    <style>
        body { background-color: #E0FFFF; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 750px; border: 3px solid #20B2AA; }
        h1 { color: #20B2AA; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        canvas { background: #000; width: 100%; height: 180px; border-radius: 10px; margin-bottom: 15px; }
        .engines { display: flex; gap: 15px; margin-bottom: 15px; }
        .box { flex: 1; text-align: left; }
        label { font-weight: bold; color: #008B8B; display: block; margin-bottom: 5px; }
        textarea { width: 100%; height: 120px; padding: 10px; border: 2px solid #AFEEEE; border-radius: 10px; font-family: 'Courier New', monospace; box-sizing: border-box; resize: none; }
        .controls { background: #f0fdfd; padding: 15px; border-radius: 12px; display: flex; justify-content: space-around; align-items: center; }
        input { padding: 8px; border-radius: 6px; border: 1px solid #20B2AA; width: 100px; text-align: center; font-weight: bold; color: #20B2AA; }
        button { background-color: #20B2AA; color: white; border: none; padding: 12px 40px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        button.stop { background-color: #FF4500; }
        .footer { margin-top: 15px; font-size: 12px; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ’Ž Gemini Player</h1>
        <canvas id="cv"></canvas>
        <div class="engines">
            <div class="box">
                <label>ðŸ”Š Bytebeat (0-255):</label>
                <textarea id="bC" placeholder="VÃ­ dá»¥: t*(t>>8|t>>9)&t>>8"></textarea>
            </div>
            <div class="box">
                <label>ðŸŒŠ Floatbeat (-1 to 1):</label>
                <textarea id="fC" placeholder="VÃ­ dá»¥: sin(t/50)"></textarea>
            </div>
        </div>
        <div class="controls">
            <div>
                <span style="font-size: 14px; color: #555;">Sample Rate:</span>
                <input type="number" id="sr" value="8000"> 
            </div>
            <button id="pB">PLAY</button>
        </div>
        <div class="footer">Dá»± Ã¡n bá»Ÿi Hiáº¿u (leviethoan-dev) | Code sai lÃ  ngon luÃ´n! ðŸš€</div>
    </div>

<script>
    let a, s, t = 0, playing = false;
    const cv = document.getElementById('cv'), ctx = cv.getContext('2d');
    const srInput = document.getElementById('sr'), bInput = document.getElementById('bC'), fInput = document.getElementById('fC');

    // KhÃ´i phá»¥c dá»¯ liá»‡u tá»« bá»™ nhá»› localStorage
    window.onload = () => {
        bInput.value = localStorage.getItem('gm_byte') || "t*(t>>8|t>>9)&t>>8";
        fInput.value = localStorage.getItem('gm_float') || "";
        srInput.value = localStorage.getItem('gm_sr') || "8000";
    };

    function saveData() {
        localStorage.setItem('gm_byte', bInput.value);
        localStorage.setItem('gm_float', fInput.value);
        localStorage.setItem('gm_sr', srInput.value);
    }

    function start() {
        saveData();
        const srValue = parseFloat(srInput.value) || 8000;
        
        try {
            a = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: srValue });
            s = a.createScriptProcessor(4096, 1, 1);
            
            // Khai bÃ¡o cÃ¡c hÃ m toÃ¡n há»c Ä‘á»ƒ dÃ¹ng trong eval() / new Function
            const {sin, cos, tan, floor, abs, random, PI, min, max, pow, sqrt} = Math;
            const bVal = bInput.value.trim();
            const fVal = fInput.value.trim();
            
            let fB, fF;
            // Ká»¹ thuáº­t eval/Function Ä‘á»‰nh cao cá»§a Hiáº¿u Ä‘á»ƒ nháº¡c khÃ´ng lag
            if (bVal) fB = new Function('t', 'sin', 'cos', 'tan', 'floor', 'abs', 'random', 'PI', 'min', 'max', 'pow', 'sqrt', `return ${bVal};`);
            if (fVal) fF = new Function('t', 'sin', 'cos', 'tan', 'floor', 'abs', 'random', 'PI', 'min', 'max', 'pow', 'sqrt', `return ${fVal};`);

            s.onaudioprocess = (e) => {
                if (!playing) return;
                const out = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < out.length; i++) {
                    let vB = bVal ? (((fB(t,sin,cos,tan,floor,abs,random,PI,min,max,pow,sqrt)|0)&255)/127.5)-1 : 0;
                    let vF = fVal ? fF(t,sin,cos,tan,floor,abs,random,PI,min,max,pow,sqrt) : 0;
                    
                    if (bVal && fVal) out[i] = (vB + vF) / 2;
                    else out[i] = bVal ? vB : vF;
                    t++;
                }
                // Váº½ Visualizer sÃ³ng nháº¡c
                draw(out);
            };
            s.connect(a.destination);
        } catch(e) { 
            // BÃ­ máº­t Rickroll khi code sai
            alert("Code sai lÃ  ngon luÃ´n! ThÆ°á»Ÿng ngay bÃ i Rickroll."); 
            window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ", "_blank");
            location.reload();
        }
    }

    function draw(out) {
        ctx.fillStyle = 'black'; ctx.fillRect(0,0,cv.width,cv.height);
        ctx.strokeStyle = '#00FFFF'; ctx.lineWidth = 2; ctx.beginPath();
        for(let j=0; j<out.length; j+=8) {
            let x = (j/out.length)*cv.width, y = (out[j]*0.5+0.5)*cv.height;
            if(j==0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.stroke();
    }

    document.getElementById('pB').onclick = () => {
        if (playing) {
            saveData();
            location.reload(); 
        } else {
            playing = true;
            document.getElementById('pB').innerText = "STOP & SAVE";
            document.getElementById('pB').classList.add('stop');
            start();
        }
    };
</script>
</body>
</html>